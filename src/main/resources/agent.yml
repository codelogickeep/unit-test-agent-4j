# =============================================================================
# Unit Test Agent 4j - Configuration File
# =============================================================================

# LLM Settings
llm:
  protocol: "openai"                      # openai | openai-zhipu | anthropic | gemini
  apiKey: "${env:UT_AGENT_API_KEY}"       # API Key (supports env var)
  baseUrl: "${env:UT_AGENT_BASE_URL}"     # Base URL (auto handles /v1 suffix)
  modelName: "${env:UT_AGENT_MODEL_NAME}" # Model name
  temperature: 0.0                        # 0.0 (precise) ~ 1.0 (creative)
  timeout: 120                            # Request timeout in seconds
  customHeaders: {}                       # Custom HTTP headers (optional)
    # X-Custom-Header: "value"

# Workflow Settings
workflow:
  maxRetries: 5                           # Max retry attempts on failure
  coverageThreshold: 80                   # Coverage threshold (%)
  interactive: false                      # Interactive confirmation mode
  use-lsp: false                          # Use LSP for syntax check (auto-downloads JDT LS)
  # default-skill: "full"                 # Default skill name (null = use all tools)
  iterative-mode: false                   # Enable iterative method testing mode
  method-coverage-threshold: 80           # Per-method coverage threshold (%)
  skip-low-priority: false                # Skip low-priority methods (P2) in iterative mode
  max-stale-iterations: 3                 # Stop after N iterations without progress
  min-coverage-gain: 1                    # Minimum coverage gain (%) per iteration to continue

# Batch Mode Settings (for --project)
batch:
  excludePatterns: ""                     # Glob patterns to exclude (comma-separated)
    # Example: "**/dto/**,**/vo/**,**/domain/**"
  dryRun: false                           # Analyze only, no generation

# Incremental Mode Settings (for --incremental)
incremental:
  mode: "uncommitted"                     # uncommitted | staged | compare
  # baseRef: "main"                       # Base ref for compare mode (required for compare)
  targetRef: "HEAD"                       # Target ref for compare mode
  # excludePatterns: ".*Test\\.java"      # Regex patterns to exclude files

# Recommended Dependencies & Minimum Versions (for env check)
dependencies:
  junit-jupiter: "5.10.1"
  mockito-core: "5.8.0"
  mockito-junit-jupiter: "5.8.0"
  mockito-inline: "5.8.0"
  byte-buddy: "1.14.10"
  objenesis: "3.3"
  jacoco-maven-plugin: "0.8.11"

# Prompts Configuration
prompts:
  system: "prompts/system-prompt.st"      # System prompt template path

# MCP Configuration (Model Context Protocol)
mcp:
  servers: []                             # MCP server configurations
    # - name: "server-name"
    #   url: "http://localhost:8080"

# Skills Configuration - Dynamic Tool Selection
# Each skill defines a subset of tools to reduce token usage
# Use --skill <name> or set workflow.default-skill to activate
skills:
  # Analysis phase - read and understand source code
  - name: "analysis"
    description: "Code analysis phase - read and understand source code"
    tools:
      - CodeAnalyzerTool
      - FileSystemTool
      - BoundaryAnalyzerTool
      - StyleAnalyzerTool
      - ProjectScannerTool
      - TestDiscoveryTool

  # Generation phase - generate and write test code
  - name: "generation"
    description: "Test generation phase - generate and write test files"
    tools:
      - FileSystemTool
      - DirectoryTool
      - KnowledgeBaseTool
      - SyntaxCheckerTool
      - CodeAnalyzerTool

  # Verification phase - run tests and check coverage
  - name: "verification"
    description: "Test verification phase - execute tests and check coverage"
    tools:
      - MavenExecutorTool
      - TestReportTool
      - CoverageTool
      - FileSystemTool
      - MutationTestTool

  # Repair phase - fix failing tests
  - name: "repair"
    description: "Repair phase - fix test failures based on error reports"
    tools:
      - FileSystemTool
      - TestReportTool
      - CodeAnalyzerTool
      - SyntaxCheckerTool
      - MavenExecutorTool

  # Iterative mode - per-method test generation
  - name: "iterative"
    description: "Iterative mode - generate tests method by method with priority"
    tools:
      - CodeAnalyzerTool
      - CoverageTool
      - MethodIteratorTool
      - FileSystemTool
      - DirectoryTool
      - SyntaxCheckerTool
      - MavenExecutorTool
      - TestReportTool
      - KnowledgeBaseTool

  # Full toolset (default) - use all available tools
  - name: "full"
    description: "Full toolset - use all available tools"
    tools: []  # Empty means use all tools
